 /*!
 * ColorPicker
 * A small plugin for selecting colors, build on jQuery.
 *
 * by Adam Drago
 */
(function(){"use strict";var e=$(this),t='<div class="color-picker-overlay hide"></div>'+'<div class="color-picker hide">'+'<div class="color-picker-arrow"></div>'+'<div class="color-sample-wrap box-wrap">'+'<div class="color-sample box"></div>'+"</div>"+'<a href="#" class="close">Ã—</a>'+'<div class="color-box-wrap box-wrap">'+'<div class="color-box box">'+'<div class="color-box-overlay"></div>'+'<div class="color-box-handle"><div class="color-box-handle-inner"></div></div>'+"</div>"+"</div>"+'<div class="box-wrap hue-slider-wrap">'+'<div class="box hue-slider"><div class="hue-slider-handle"></div></div>'+"</div>"+"</div>";this.ColorPicker=function(e){var t=this;this.$el=null;this.$overlay=null;this.$cancel=null;this.property=e.property||"background-color";this.color=new Color;this.init(e)};ColorPicker.prototype={init:function(e){var n=this,r=$(t),i=e.target,s=e.trigger,o=e.triggerEvent,u=$("body"),a=this.$el=r.filter(".color-picker").appendTo(u);this.$overlay=r.filter(".color-picker-overlay").appendTo(u);this.$close=a.find(".close");this.target=new ColorPicker.Target({$el:i||null,property:e.property});this.setColor(this.target.getColor());this.colorBox=new ColorPicker.ColorBox({$el:a.find(".color-box"),$handle:a.find(".color-box-handle"),parent:this});this.colorSample=new ColorPicker.ColorSample({$el:a.find(".color-sample"),parent:this});this.hueSlider=new ColorPicker.HueSlider({$el:a.find(".hue-slider"),$handle:a.find(".hue-slider-handle"),parent:this});if(o){if(s){s.on(o,function(){n.show.call(n)})}else{i.on(o,function(){n.show.call(n)})}}this.positionAtStart()},setupEvents:function(){var t=this,n=this.colorBox,r=this.hueSlider,i=function(i){var s=n.$el.offset(),o=r.$el.offset(),u=i.pageX-s.left,a=i.pageY-s.top,f=i.pageX-o.left,l=i.pageY-o.top;if(u>n.minX&&u<n.maxX&&a>n.minY&&a<n.maxY){n.setHandlePosition(u,a);t.setColor({hsv:[r.hue,n.saturation,n.brightness]});e.on("mousemove.colorPicker",function(e){var i=e.pageX-s.left,o=e.pageY-s.top;n.setHandlePosition(i,o);t.setColor({hsv:[r.hue,n.saturation,n.brightness]})})}else if(l>r.minY&&l<r.maxY&&f>r.minX&&f<r.maxX){r.setHandlePosition(l);t.setColor({hsv:[r.hue,n.saturation,n.brightness]});e.on("mousemove.colorPicker",function(e){var i=e.pageX-o.left,s=e.pageY-o.top;r.setHandlePosition(s);t.setColor({hsv:[r.hue,n.saturation,n.brightness]})})}i.preventDefault()},s=function(t){e.off("mousemove.colorPicker")},o=function(){t.hide();return false};e.on({"mousedown.colorPicker":i,"mouseup.colorPicker":s});this.$close.on("click.colorPicker",o);this.$overlay.on("click.colorPicker",o)},teardownEvents:function(){e.off(".colorPicker");this.$close.off(".colorPicker");this.$overlay.off(".colorPicker")},show:function(){this.setupEvents();this.positionByTarget();this.$el.removeClass("hide");this.$overlay.removeClass("hide");this.target.$el.addClass("active");this.target.init()},hide:function(){this.teardownEvents();this.$el.addClass("hide");this.$overlay.addClass("hide");this.target.$el.removeClass("active");this.target.destroy()},positionAtStart:function(){this.$el.css({left:-this.$el.outerWidth()}).off(".colorPickerOut")},positionByTarget:function(){var t=e.width(),n=e.height(),r=this.target.$el,i=r.offset(),s=i.left,o=i.top,u=r.width(),a=r.outerHeight(),f=o<0,l=o+a>n,c=this.$el,h=c.offset(),p=h.top,d=c.outerWidth(),v=c.outerHeight(),m=s,g=t-(s+u),y=o,b=n-(o+a),w=0,E=Math.round(o+a/2-v/2),S=E<0,x=E+v>n,T="transform-left";if(g>=m){w=Math.round(s+u+10)}else{w=Math.round(s-d-10);T="transform-right"}if(S){if(f){}else{E=o;T=g>=m?"transform-top-left":"transform-top-right"}}else if(x){if(l){}else{E=o+a-v;T=g>=m?"transform-bottom-left":"transform-bottom-right"}}this.$el.css({top:E,left:w}).addClass(T)},setColor:function(e){this.color.set(e);this.target.setColor(this.color.getRgba())},showColor:function(e){this.colorBox.setHandlePosition(e);this.colorBox.setHue(e.getHsv()[0]);this.hueSlider.setHandlePosition(e);this.colorSample.setColor(e.getRgba());this.target.setColor(e.getRgba())}};ColorPicker.Target=function(e){this.property=e.property;this.$el=e.$el;this.init()};ColorPicker.Target.prototype={init:function(){this.$el.addClass("color-picker-target")},destroy:function(){this.$el.removeClass("color-picker-target")},setColor:function(e){this.$el.css(this.property,"rgba("+e.join(",")+")")},getColor:function(){return this.$el.css(this.property)}};ColorPicker.ColorSample=function(e){this.parent=e.parent;this.$el=e.$el||null;this.setColor(this.parent.color.getRgba())};ColorPicker.ColorSample.prototype={setColor:function(e){this.$el.css("background-color","rgba("+e.join(",")+")")}};ColorPicker.ColorBox=function(e){this.$el=e.$el||null;this.$handle=e.$handle||null;this.parent=e.parent;this.maxY=0;this.minY=0;this.maxX=0;this.minX=0;this.centerOffset=0;this.saturation=0;this.brightness=0;this.init()};ColorPicker.ColorBox.prototype={init:function(){var e=this,t=this.$el.height(),n=this.$el.width(),r=this.$handle.outerHeight(true),i=this.$handle.outerWidth(true);this.minX=0;this.minY=0;this.maxY=t-1;this.maxX=n-1;this.centerOffset=r/2;var s=this.parent.color.getHsv();this.saturation=s[1];this.brightness=s[2];this.setHandlePosition(this.parent.color);this.setHue(s[0]);this.$el.attr("unselectable","on")},setHandlePosition:function(e,t){if(t!==undefined){var n=t<this.minY?this.minY:t>this.maxY?this.maxY:t,r=e<this.minX?this.minX:e>this.maxX?this.maxX:e,i=255-n,s=r,o=this.parent.hueSlider.hue,u=s/255,a=i/255,f=this.parent.color.getHsv();this.saturation=u;this.brightness=a;this.$handle.css({top:n-this.centerOffset,left:r-this.centerOffset});this.parent.colorSample.setColor((new Color({hsv:[o,u,a]})).getRgba())}else{var f=e.getHsv(),s=f[1]*255,i=(1-f[2])*255;this.$handle.css({top:i-this.centerOffset,left:s-this.centerOffset})}},setHue:function(e){var t=Color.hsvaToRgba([e,1,1]);this.$el.css("background-color","rgba("+t.join(",")+")")}};ColorPicker.HueSlider=function(e){this.parent=e.parent;this.$el=e.$el||null;this.$handle=e.$handle||null;this.minX=0;this.maxX=0;this.minY=0;this.maxY=0;this.hue=0;this.init()};ColorPicker.HueSlider.prototype={init:function(){var e=this,t=this.$el.height(),n=this.$el.width(),r=this.$handle.outerWidth(true);this.minY=0;this.maxY=t-1;this.minX=n-r;this.maxX=n-1;this.setHandlePosition(this.parent.color)},setHandlePosition:function(e){var t,n=this.parent.color.getHsv();if(!_.has(e,"hsva")){t=e<this.minY?this.minY:e>this.maxY?this.maxY:e;this.hue=1-t/this.maxY}else{this.hue=e.getHsv()[0];t=(1-this.hue)*this.maxY}this.$handle.css({top:t-1});this.parent.colorBox.setHue(this.hue);this.parent.colorSample.setColor((new Color({hsv:[this.hue,n[1],n[2]]})).getRgba())}}}).call(this)